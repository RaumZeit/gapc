check_eq elm.gap ElMamunMain.lhs seller '1+2*3*4+5' foo

# old-adpc-bug: counts wrong with this example

check_eq elm.gap ElMamunMain.lhs pretty2 '1+2*3*4' rope

check_eq elm.gap ElMamunMain.lhs count '1+2*3*4+5' foo
check_eq elm.gap ElMamunMain.lhs buyer '1+2*3*4+5' foo
check_eq elm.gap ElMamunMain.lhs buyerpp '1+2*3*4+5' foo
check_eq elm.gap ElMamunMain.lhs sellercnt '1+2*3*4+5' foo
check_eq elm.gap ElMamunMain.lhs buyerpp '0+0*0+0*0+0*0' lot
check_eq elm.gap ElMamunMain.lhs timebuyerpp '1+2*3*4+5' foo

check_eq elm_helper.gap ElMamunMain.lhs buyer '1+2*3*4+5' helper


GAPC="../../../gapc -p buyer*pretty"
IGNORE_INSTANCE="yes"
check_eq elm.gap ElMamunMain.lhs buyerpp '1+2*3*4+5' prodcmd
GAPC=../../../gapc
IGNORE_INSTANCE="no"

check_eq nussinov.gap NussinovMain.lhs pretty acgt foo
check_eq nussinov.gap NussinovMain.lhs bpmax acgt foo
check_eq nussinov.gap NussinovMain.lhs bpmaxpp aauauccccccccccaccccccauucccccccccccccaauuuccc foo
check_eq nussinov.gap NussinovMain.lhs count aauauccccccccccaccccccauucccccccccccccaauuuccc foo
check_eq nussinov.gap NussinovMain.lhs bpmaxcnt aauauccccccccccaccccccauucccccccccccccaauuuccc foo

check_eq nussinov2.gap NussinovMain.lhs pretty acgt foo
check_eq nussinov2.gap NussinovMain.lhs bpmax acgt foo
check_eq nussinov2.gap NussinovMain.lhs bpmaxpp aauauccccccccccaccccccauucccccccccccccaauuuccc foo
check_eq nussinov2.gap NussinovMain.lhs count aauauccccccccccaccccccauucccccccccccccaauuuccc foo
check_eq nussinov2.gap NussinovMain.lhs bpmaxcnt aauauccccccccccaccccccauucccccccccccccaauuuccc foo

check_eq nussinov2.gap NussinovMain.lhs acount aauauccccccccccaccccccauucccccccccccccaauuuccc foo

GAPC="../../../gapc -t --inline"

check_eq elm.gap ElMamunMain.lhs buyer '1+2*3*4+5' inline

GAPC="../../../gapc -t --backtrack"

check_eq elm.gap ElMamunMain.lhs buyerpp '1+2*3*4+5' bt
check_eq nussinov.gap NussinovMain.lhs bpmaxpp aauauccccccccccaccccccauucccccccccccccaauuuccc bt
check_eq nussinov2.gap NussinovMain.lhs bpmaxpp aauauccccccccccaccccccauucccccccccccccaauuuccc bt

GAPC="../../../gapc -t --cyk"

check_eq elm.gap ElMamunMain.lhs buyer '1+2*3*4+5' cyk
check_eq nussinov.gap NussinovMain.lhs bpmax aauauccccccccccaccccccauucccccccccccccaauuuccc cyk
check_eq nussinov2.gap NussinovMain.lhs bpmax aauauccccccccccaccccccauucccccccccccccaauuuccc cyk
check_eq affinelocsim.gap AffineLocSimMain.lhs affine darling\$enilria cyk

check_eq affinelocsim2.gap AffineLocSimMain.lhs affine darling\ airline cyk.multitrack

check_eq affinelocsim2.gap AffineLocSimMain.lhs affinepp darling\ airline cyk.multitrack

GAPC="../../../gapc -t --cyk --kbacktrack"

check_eq affinelocsim2.gap AffineLocSimMain.lhs affinepp darling\ airline kbt.cyk.multitrack

GAPC="../../../gapc -t --cyk"
LDLIBS_EXTRA=../../../librna/librna.a
RUN_CPP_FLAGS="-P ../../../librna/vienna/rna_turner1999.par"

check_eq adpf.gap AdpfMain.lhs mfe cucccugauacccucaugccucgugggacacuagaacguauccaugucuucgugggacgugagcguucuucacgcguccgucaguguacgcccuagagucgccgauugcgccgaugguuugagcagcaacgcgaucuacuuuccaucaggauaaacguugacuuuuaguaagaaacacagccucagcuaggcugcccuuauaguucaacggcuccgguaccguuauccucuaguccucauucccuugauccugauacgcugguguaccgcuaagcacuagaauuauggugcaguaguuacugugccuuaucaugcgcgcgguuuccacuc cyk

LDLIBS_EXTRA=""
RUN_CPP_FLAGS=""

GAPC="../../../gapc"


check_eq palloc.gap PallocMain.lhs pretty 1abccba12xyzzyx2 foo
check_eq palloc.gap PallocMain.lhs count 1abccba12xyzzyx2 foo
check_eq palloc.gap PallocMain.lhs score 1abccba12xyzzyx2 foo
check_eq palloc.gap PallocMain.lhs scorepp 1abc5cba3xyz4zyx2 foo
check_eq palloc.gap PallocMain.lhs scorecnt 1abccba12xyzzyx2 foo

#check_eq affinelocsim.gap AffineLocSimMain.lhs pretty darling\$enilria foo

# old-adpc-bug: counts wrong with this example

check_eq affinelocsim.gap AffineLocSimMain.lhs count darling\$enilria foo
check_eq affinelocsim.gap AffineLocSimMain.lhs affine darling\$enilria foo
check_eq affinelocsim.gap AffineLocSimMain.lhs affinepp darling\$enilria foo
check_eq affinelocsim.gap AffineLocSimMain.lhs affinecnt darlingairl\$enilria foo

LDLIBS_EXTRA=../../../librna/librna.a

check_eq adpf.gap AdpfMain.lhs count acgugggcuuccaauuggaaccacgugggcuuccaauugg foo
check_eq adpf.gap AdpfMain.lhs count CAUUAGACCUCUUCAAUGCACGUAGCCUACGCGACACUUACUGUAUAUUUAAACAAGCACUUUCGAAAUAUUCGGUAUAGCCUUCGCGGGUGGGGACUAUCA bar
check_eq adpf.gap AdpfMain.lhs pretty acgugggcuuccaauuggaaccacgugggcuuccaauugg foo
check_eq adpf.gap AdpfMain.lhs shape5 ggggccccggggccccggggcccc foo
check_eq adpf.gap AdpfMain.lhs shape5 acgugggcuuccaauuggaaccacgugggcuuccaauugg bar
check_eq adpf.gap AdpfMain.lhs bpmaxpp acgugggcuuccaauuggaaccacgugggcuuccaauugg foo
check_eq adpf.gap AdpfMain.lhs bpmaxpp cgaucaucgaucagucagucagucaugcuagacugaucuacguuagcgucagucaugcagucuagguacgucagucagucaguguccagucagucagcua bar

check_eq adpf.gap AdpfMain.lhs bpmaxpp ccucagaccaccuuuuuugcucagucuggccugcgacugg baz
check_eq adpf.gap AdpfMain.lhs bpmaxpp acggugaaggagcggcuaaccccaucuccgucgccuccgu bas
check_eq adpf.gap AdpfMain.lhs bpmaxpp ggagucgcgguaccacacgcccaugugaauucauggguguu bast


check_eq adpf.gap AdpfMain.lhs bpmax ccaagg foo


check_eq stefan3.gap Stef3Main.lhs count CAUUAGACCUCUUCAAUGCACGUAGCCUACGCGACACUUACUGUAUAUUUAAACAAGCACUUUCGAAAUAUUCGGUAUAGCCUUCGCGGGUGGGGACUAUCA foo
check_eq stefan3.gap Stef3Main.lhs count ccCCaaaGGCCaaaGGggccccCCaaaGGccCCaaaGGCCaaaGGggCCaaaGGggCCaaaGGCCaaaGGggCCaaaGG bar


check_eq rnashapes1.gap RNAshapesCount.lhs count ugcgggacuagucuauucucauaccauuuuuagggcuagaggaucag foo
check_eq rnashapes1.gap RNAshapesCount.lhs count gauguggcguaugcccacgacuacagauacccauuaagguggcaaaaauacgaucagccccgccaugauaagcgucaggacuugguuugcgugcauuugu bar

LDLIBS_EXTRA=""
RUN_CPP_FLAGS="-P ../../../librna/vienna/rna_turner1999.par"

LDLIBS_EXTRA=../../../librna/librna.a
check_eq adpf.gap AdpfMain.lhs ppmfe GGGaaaCCC foo

check_eq adpf.gap AdpfMain.lhs mfepp guccugucaaacgcgaaacgagaggguacugucuaguacgaggaaggggacuauguccacucuccgccgauaaugcagagacgacuacgaacauacuucuuagaaugcgccauugu foo
check_eq adpf.gap AdpfMain.lhs mfepp uaccuuugugcaccgcaacuaucucacaaucauuagacacuuuauuuauaaccugccaagcc bas
check_eq adpf.gap AdpfMain.lhs mfepp cucccugauacccucaugccucgugggacacuagaacguauccaugucuucgugggacgugagcguucuucacgcguccgucaguguacgcccuagagucgccgauugcgccgaugguuugagcagcaacgcgaucuacuuuccaucaggauaaacguugacuuuuaguaagaaacacagccucagcuaggcugcccuuauaguucaacggcuccgguaccguuauccucuaguccucauucccuugauccugauacgcugguguaccgcuaagcacuagaauuauggugcaguaguuacugugccuuaucaugcgcgcgguuuccacuc bar

GAPC="../../../gapc -t --cyk --backtrack"
check_eq adpf.gap AdpfMain.lhs mfepp cucccugauacccucaugccucgugggacacuagaacguauccaugucuucgugggacgugagcguucuucacgcguccgucaguguacgcccuagagucgccgauugcgccgaugguuugagcagcaacgcgaucuacuuuccaucaggauaaacguugacuuuuaguaagaaacacagccucagcuaggcugcccuuauaguucaacggcuccgguaccguuauccucuaguccucauucccuugauccugauacgcugguguaccgcuaagcacuagaauuauggugcaguaguuacugugccuuaucaugcgcgcgguuuccacuc bt

# FIXME should be more generic ...
if [ `uname` == Linux ]; then
  CPPFLAGS_EXTRA="-I../../.. -I../../../librna -I.. -I../../gapc_filter -fopenmp"
  LDLIBS_EXTRA="../../../librna/librna.a -fopenmp"
else
  CPPFLAGS_EXTRA="-I../../.. -I../../../librna -I.. -I../../gapc_filter -xopenmp"
  LDLIBS_EXTRA="../../../librna/librna.a -xopenmp"
fi
OMP_NUM_THREADS=2
export OMP_NUM_THREADS

check_eq adpf.gap AdpfMain.lhs mfepp cucccugauacccucaugccucgugggacacuagaacguauccaugucuucgugggacgugagcguucuucacgcguccgucaguguacgcccuagagucgccgauugcgccgaugguuugagcagcaacgcgaucuacuuuccaucaggauaaacguugacuuuuaguaagaaacacagccucagcuaggcugcccuuauaguucaacggcuccgguaccguuauccucuaguccucauucccuugauccugauacgcugguguaccgcuaagcacuagaauuauggugcaguaguuacugugccuuaucaugcgcgcgguuuccacuc openmp

export OMP_NUM_THREADS=

RUN_CPP_FLAGS=""
LDLIBS_EXTRA=""
GAPC="../../../gapc -t"
CPPFLAGS_EXTRA="-I../../.. -I../../../librna -I.. -I../../gapc_filter"

check_eq cmsmallint.gap CmsmallMain.lhs scorepp aa foo
check_eq cmsmallint.gap CmsmallMain.lhs scorepp cguaguacguacgucagcguaguacgucaguca bar
check_eq cmsmallint.gap CmsmallMain.lhs scorepp auaaugggaccgccaucagaacuguggaagucaccgcuuguggauggauaaucggucaaggggucauccuacuguggagcgacgugcggccccacuucaacuagcgccuauacgcgccuugcgcccguguuaagaaaaagcgauggguuauuacucgcacugucucguggacucucgcgcgcgaugcucacuucccaauuauggguugaaggaggcuuuacgagggggaugggguugcgg bas


LDLIBS_EXTRA="-lgmpxx -lgmp"
GAPC="../../../gapc --tab-all --cyk"
CPPFLAGS_EXTRA="-I../../.. -I.. -I../../gapc_filter"


check_eq hsinfernal.gap HsinfMain.lhs ambiprob a foo

GAPC="../../../gapc -t" # --cyk"
CPPFLAGS_EXTRA="-I../../.. -I../../../librna -I.. -I../../gapc_filter"
LDLIBS_EXTRA=../../../librna/librna.a
SED=`cat ../../../config.mf | grep "^SED" | cut -d "=" -f 2`
CPP_FILTER="$SED -i -e s/(\([^,]\\+\),[^)]\\+)/\\1/"
RUN_CPP_FLAGS="-P ../../../librna/vienna/rna_turner1999.par"

check_eq rnashapesmfe.gap RNAshapesMfeMain.lhs mfepp augguguaaccggugggacaauacaauaacuuugacagagguacgugauugagaucaauuucuaaagcuuuggaccccguugcaguauga foo

check_eq rnashapesmfe.gap RNAshapesMfeMain.lhs mfepp augguguaaccgguggga bar

# former haskell co-optimal bug example
check_eq rnashapesmfe.gap RNAshapesMfeMain.lhs mfepp aaccgaaucgaaggaa bas

GAPC="../../../gapc -t --subopt"

rm -f temp/string.o
check_eq rnashapesmfe.gap RNAshapesMfeMain.lhs mfeppshape CCacaccaacacacCuGuCACGGGAGAGAAuGuGGGuuCAAAuCCCAuCGGuCGCGCCA subopt

GAPC="../../../gapc -t"
CPPFLAGS_EXTRA="-I../../.. -I../../../librna -I.. -I../../gapc_filter -O3 -DNDEBUG"
OWN_CMP_OUTPUT="cmp_fp_output"
EPSILON=1e+20 #haskell-ADP should be: 1.2458508e25 and BGAP: 1.24586e+25, thus we need a really high epsilon
CPP_FILTER=""

#check_eq rnashapespf.gap RNAshapesPFMain.lhs pf GGAGAGAUGGCUGAGUGGUUGAUAGCUCCGGUCUUGAAAACCGGUAUAGUUCUAGGAACUAUCGAGGGUUCGAAUCCCUCUCUCUCCUGGAGAGAUGGCUGAGUGGUUGAUAGCUCCGGUCUUGAAAACCGGUAUAGUUCUAGGAACUAUCGAGGGUUCGAAUCCCUCUCUCUCCU pf

check_eq rnashapespf.gap RNAshapesPFMain.lhs pf GGAGAGAUGGCUGAGUGGUUGAUAGCUCCGGUCUUGAAAACCGGUAUAGUUCUAGGAACUAUCGAGGGUUCGAAU pf

GAPC="../../../gapc -t"
CPPFLAGS_EXTRA="-I../../.. -I../../../librna -I.. -I../../gapc_filter"
OWN_CMP_OUTPUT=""
RUN_CPP_FLAGS=""

check_eq adpf_multi.gap AdpfMain.lhs bpmax ccaagg multi
check_eq adpf_multi.gap AdpfMain.lhs count augguguaaccggugggacaauacaa multi


GAPC="../../../gapc -t --kbacktrack"
CPPFLAGS_EXTRA="-I../../..  -I.. -I../../gapc_filter"

check_eq nussinov2.gap NussinovMain.lhs kbpmaxpp acgtccagcgacag kbt

GAPC="../../../gapc -t --kbacktrack --cyk"

check_eq nussinov.gap NussinovMain.lhs kbpmaxpp acgtccagcgacag kbt

GAPC="../../../gapc -t --kbacktrack "

check_eq nussinov.gap NussinovMain.lhs bpmaxpp acgtccagcgacag kbtsingle

check_eq elm.gap ElMamunMain.lhs buyerpp '0+0*0+0*0+0*0' kbtsingle

RUN_CPP_FLAGS="-P ../../../librna/vienna/rna_turner1999.par"

check_eq adpf.gap AdpfMain.lhs shapemfepp cgcugaacgcggaucaaugucgcugaacgcggaucaaugucgcugaacgcggaucaaugu kbt

RUN_CPP_FLAGS=""
GAPC="../../../gapc -t"

check_eq elm_nonreachable.gap ElMamunMain.lhs buyer '1+2*3*4+5' nonreachable


check_eq adpf.gap AdpfMain.lhs prettyshape aaccccuuuuugggga nop


check_eq matrix.gap MatrixMultMain.lhs minmult "10,100,100,5,5,50," matrixys


check_eq nussinovDurbin.gap NussinovDurbinMain.lhs count acguacgu durbinnuss


GAPC="../../../gapc -p bpmax*bpmax"
IGNORE_INSTANCE="yes"
check_eq nussinov.gap NussinovMain.lhs bpmaxbpmax aauauccccccccccaccccccauucccccccccccccaauuuccc prodcmdcopy
#GAPC="../../../gapc -p bpmax*bpmax --backtrack"
#check_eq nussinov.gap NussinovMain.lhs foo aauauccccccccccaccccccauucccccccccccccaauuuccc prodcmdcopybt
GAPC=../../../gapc
IGNORE_INSTANCE="no"


GAPC="../../../gapc --cyk -t -p mfe"
IGNORE_INSTANCE="yes"
LDLIBS_EXTRA=../../../librna/librna.a
RUN_CPP_FLAGS="-P ../../../librna/vienna/rna_turner1999.par"

check_eq adpf_index.gap AdpfMain.lhs mfe cucccugauacccucaugccucgugggacacuagaacguauccaugucuucgugggacgugagcguucuucacgcguccgucaguguacgcccuagagucgccgauugcgccgaugguuugagcagcaacgcgaucuacuuuccaucaggauaaacguugacuuuuaguaagaaacacagccucagcuaggcugcccuuauaguucaacggcuccgguaccguuauccucuaguccucauucccuugauccugauacgcugguguaccgcuaagcacuagaauuauggugcaguaguuacugugccuuaucaugcgcgcgguuuccacuc cykindex

LDLIBS_EXTRA=""
GAPC=../../../gapc
IGNORE_INSTANCE="no"
LDLIBS_EXTRA=""
RUN_CPP_FLAGS=""


check_eq elm_filter.gap ElMamunMain.lhs buyer '1*2' blockfilter

GAPC="../../../gapc -t --kbacktrace "
GRAMMAR="../../grammar2"

check_eq elmfn.gap ElMamunMain.lhs buyerpp '1+2*3*4+5' compile

GAPC="../../../gapc -t --cyk -I../../grammar2"

check_eq elminclude.gap ElMamunMain.lhs buyer '1+2*3*4+5' include

GRAMMAR="../../grammar2"
GAPC="../../../gapc -t"

check_eq elmfilt.gap ElMamunMain.lhs buyer '1+2*3*4+5' nonblockfilter

